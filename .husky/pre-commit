#!/bin/sh

# Run rubocop on staged files
bin/rubocop-quick || exit 1

# Run tests
echo "Running tests..."
bin/rails test || exit 1

# Run brakeman security scan
echo "Running Brakeman security scan..."
bin/brakeman -q || exit 1

# Generate TypeScript types if schemas changed
if git diff --cached --name-only | grep -q "app/commands/video_production/node/schemas/"; then
  echo "Schema changes detected, generating TypeScript types..."
  bundle exec rake typescript:generate || exit 1

  # Stage generated TypeScript files
  git add typescript/src/
  echo "✅ TypeScript types generated and staged"
fi

echo "✅ All pre-commit checks passed!"
